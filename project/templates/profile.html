<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="shortcut icon" href="../static/img/logo.png" type="x-icon" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../static/css/profile.css">
   
</head>
<body>
    <div class="top-bar">
        <div class="user-info">
            <span>{{ username }}</span>
            <a href="/logout" class="btn-logout"><i class="fas fa-sign-out-alt"></i>Log Out</a>
        </div>
    </div>

    <div class="container">
        <div class="profile-info">
            <h1>User Profile</h1>
            <a href="#" id="editProfileBtn"><i class="fas fa-user-edit"></i>Edit Profile</a>
            <div class="user-details">
                <p><strong>Username:</strong> <span id="profile-username" contenteditable="false">{{ user.username }}</span></p>
                <p><strong>Email:</strong> <span id="profile-email" contenteditable="false">{{ user.email }}</span></p>
                <p><strong>Phone:</strong> <span id="profile-phone" contenteditable="false">{{ user.phone }}</span></p>
            </div>
            <button id="saveProfileBtn" class="btn-save" style="display: none;">Save Profile</button>
            <button id="cancelEditBtn" class="btn-cancel" style="display: none;">Cancel</button>
            <div id="updateMessage" class="message"></div>
        </div>
    </div>
    
    <script>
       $(document).ready(function() {
            $('#editProfileBtn').click(function(e) {
                e.preventDefault();
                $('.user-details span').attr('contenteditable', 'true');
                $('.user-details span').css({
                    'border': '1px solid var(--color-border)',
                    'padding': '5px',
                    'background-color': 'transparent',
                    'color': 'inherit'
                });
                $('#saveProfileBtn').show();
                $('#cancelEditBtn').show();
                $(this).hide();
            });

            $('#saveProfileBtn').click(function(e) {
                e.preventDefault();
                $('.user-details span').attr('contenteditable', 'false');
                $('.user-details span').css({
                    'border': 'none',
                    'padding': '0',
                    'background-color': 'transparent',
                    'color': 'inherit'
                });
                $(this).hide();
                $('#editProfileBtn').show();
                $('#cancelEditBtn').hide();

                var username = $('#profile-username').text();
                var email = $('#profile-email').text();
                var phone = $('#profile-phone').text();

                $.ajax({
                    url: '/update_profile',
                    type: 'POST',
                    data: {
                        username: username,
                        email: email,
                        phone: phone
                    },
                    success: function(response) {
                        if (response.success) {
                            $('#updateMessage').html('<div class="success-message">' + response.message + '</div>').show();
                        } else {
                            $('#updateMessage').html('<div class="error-message">' + response.message + '</div>').show();
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(error);
                        $('#updateMessage').html('<div class="error-message">An error occurred. Please try again later.</div>').show();
                    }
                });
            });

            $('#cancelEditBtn').click(function(e) {
                e.preventDefault();
                $('.user-details span').attr('contenteditable', 'false');
                $('.user-details span').css({
                    'border': 'none',
                    'padding': '0',
                    'background-color': 'transparent',
                    'color': 'inherit'
                });
                $('#saveProfileBtn').hide();
                $('#editProfileBtn').show();
                $(this).hide();

                // Restore original values
                var originalUsername = "{{ user.username }}";
                var originalEmail = "{{ user.email }}";
                var originalPhone = "{{ user.phone }}";

                $('#profile-username').text(originalUsername);
                $('#profile-email').text(originalEmail);
                $('#profile-phone').text(originalPhone);

                $('#updateMessage').html('').hide();
            });
        });

    </script>
</body>
</html>
